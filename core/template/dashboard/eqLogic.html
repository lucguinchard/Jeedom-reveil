<div class="eqLogic eqLogic-widget noResize " data-version="dashboard" style="overflow:hidden; height:320px; width: 220px; #background#" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#">
	<link rel="stylesheet" href="plugins/reveil/core/template/dashboard/css/style.css" />
	<span class="statusCmd" style="position : absolute;bottom : 3px;left : 3px;width : 30px;color: #404040 ;z-index: 1030;"></span>
	<div class="progr_panel">
		<table id="table_programation" class="table table-bordered table-condensed">
			<thead>
				<tr>
					<th style="width:100px;">Jour actif</th>
					<th>Heure</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<img class="sections_droite_liste tooltips noRefresh" src="plugins/reveil/core/template/dashboard/images/chevron.png" title="Listes" onClick="listefermer()"/>
	</div>
	<div class="haut_widget">
		<img class="sections_gauche tooltips noRefresh" src="plugins/reveil/core/template/dashboard/images/chevron.png" onclick="liste()" title="Informations"/>
		<span class="statusCmd" style="position : absolute;left : 5px;bottom:0px; width : 30px;z-index: 1030;"></span>
		<center class="widget-name">
			<span style="font-weight:bold;"><a href="#eqLink#">#name#</a></span>
		</center>
		<center>	
			#action#
			<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" >
				<defs>
					<line x1="100" y1="100" x2="100" y2="45" style="stroke-width: 6px; stroke: black;" id="oHeure"/>
					<line x1="100" y1="100" x2="100" y2="15" style="stroke-width: 4px; stroke: black;" id="oMinute"/>
					<line x1="100" y1="100" x2="100" y2="5"  style="stroke-width: 2px; stroke: red;" id="oSeconde"/>
				</defs>
				<g>
					<circle id="circle" style="stroke: black; fill: #d6d3ce;" cx="100" cy="100" r="100"/>
					<line style="stroke: black;" id="hour0" x1="100" y1="10"  x2="100" y2="0"/>
					<line style="stroke: black;" id="heure1" x1="150" y1="13"  x2="145" y2="22"/>
					<line style="stroke: black;" id="heure2" x1="187" y1="50"  x2="178" y2="55"/>
					<line style="stroke: black;" id="heure3" x1="190" y1="100" x2="200" y2="100"/>
					<line style="stroke: black;" id="heure4" x1="187" y1="150" x2="178" y2="145"/>
					<line style="stroke: black;" id="heure5" x1="150" y1="187" x2="145" y2="178"/>
					<line style="stroke: black;" id="heure6" x1="100" y1="190" x2="100" y2="200"/>
					<line style="stroke: black;" id="heure7" x1="50"  y1="187" x2="55"  y2="178"/>
					<line style="stroke: black;" id="heure8" x1="13"  y1="150" x2="22"  y2="145"/>
					<line style="stroke: black;" id="heure9" x1="0"   y1="100" x2="10"  y2="100"/>
					<line style="stroke: black;" id="heure10" x1="13"  y1="50"  x2="22"  y2="55" />
					<line style="stroke: black;" id="heure11" x1="50"  y1="13"  x2="55"  y2="22" />
				</g>
			</svg>
			<span class="cmd cmd-widget" data-type="action" data-subtype="other">
				#shedule#
			</span>
		</center>
	</div>
	<script type="text/javascript">
		function liste(){
			$(".eqLogic[data-eqLogic_uid=#uid#] .progr_panel").animate({left:"0px"});
			$(".eqLogic[data-eqLogic_uid=#uid#] .progr_panel").attr("class","progr_panel shadow_fenetre_reveil");
		}
		function listefermer(){
			$(".eqLogic[data-eqLogic_uid=#uid#] .progr_panel").animate({left:"-200px"});
			$(".eqLogic[data-eqLogic_uid=#uid#] .progr_panel").attr("class","progr_panel");
		}
		var d = new Date("#shedule#");
		var s = d.getSeconds();
		var m = d.getMinutes() + s / 60;
		var h = d.getHours() + m / 60;
		$(".eqLogic[data-eqLogic_uid=#uid#] svg #oSeconde").setAttribute("transform", "rotate(" + (s * 6) + ", 100, 100)");
		$(".eqLogic[data-eqLogic_uid=#uid#] svg #oMinute").setAttribute("transform", "rotate(" + (m * 6) + ", 100, 100)");
		$(".[data-eqLogic_uid=#uid#] svg #oHeure").setAttribute("transform", "rotate(" + (h * 30) + ", 100, 100)");
		$.ajax({// fonction permettant de faire de l'ajax
			type: "POST", // methode de transmission des données au fichier php
			url: "plugins/reveil/core/ajax/reveil.ajax.php", // url du fichier php
			data: {
				action: "getProgramation",
				id: "#id#"
			},
			dataType: 'json',
			global: false,
			error: function(request, status, error) {
				handleAjaxError(request, status, error);
			},
			success: function(data) { // si l'appel a bien fonctionné
				if (data.state != 'ok') {
					$('#div_alert').showAlert({message: data.result, level: 'danger'});
					return;
				}
				for(var index in data.result) {
					if( (typeof data.result[index] === "object") && (data.result[index] !== null) )
						addProgramation(data.result[index],$('#table_programation'));
				}
			}
		});
		function sendProgramation(prog,day,heure,minute){				
			$.ajax({// fonction permettant de faire de l'ajax
				type: "POST", // methode de transmission des données au fichier php
				url: "plugins/reveil/core/ajax/reveil.ajax.php", // url du fichier php
				data: {
					action: "setProgramation",
					id: "#id#",
					prog: prog,
					day: day,
					heure: heure,
					minute: minute
				},
				dataType: 'json',
				global: false,
				error: function(request, status, error) {
					handleAjaxError(request, status, error);
				},
				success: function(data) { // si l'appel a bien fonctionné
					if (data.state != 'ok') {
						$('#div_alert').showAlert({message: data.result, level: 'danger'});
						return;
					}
				}
			});
		}
		function addProgramation(_programation,  _el) {
			var Heure=$('<select class="expressionAttr form-control" data-l1key="Heure" >');
		    	var Minute=$('<select class="expressionAttr form-control" data-l1key="Minute" >');
			var number = 0;
			while (number < 24) {
				Heure.append($('<option value="'+number+'">')
					.text(number));
				number++;
			}
			number = 0;
			while (number < 60) {
				Minute.append($('<option value="'+number+'">')
					.text(number));
				number++;
			}
			var tr = $('<tr class="ProgramationGroup" data-id="'+_programation.id+'">')
				.append($('<td>')
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="1">'))
						.append('Lundi'))
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="2">'))
						.append('Mardi'))
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="3">'))
						.append('Mercredi'))
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="4">'))
						.append('Jeudi'))
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="5">'))
						.append('Vendredi'))
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="6">'))
						.append('Samedi'))
					.append($('<label class="checkbox-inline">')
						.append($('<input type="checkbox" class="expressionAttr" data-l1key="0" />'))
						.append('Dimanche')))
				.append($('<td>')
					.append(Heure)
					.append(Minute));
			_el.append(tr);
			_el.find('tr:last').setValues(_programation, '.expressionAttr');
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=Heure]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);
			});	
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=Minute]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);
				
			});	
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=1]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});	
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=2]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});	
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=3]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});	
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=4]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=5]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=6]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});
			$('.eqLogic[data-eqLogic_id=#id#] .expressionAttr[data-l1key=0]').off().on('change', function () {	
				var prog=$(this).closest('.ProgramationGroup').attr('data-id');
				var day='';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=1]').attr(':checked'))
					day+='1';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=2]').attr(':checked'))
					day+='22';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=3]').attr(':checked'))
					day+='3';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=4]').attr(':checked'))
					day+='4';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=5]').attr(':checked'))
					day+='5';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=6]').attr(':checked'))
					day+='6';
				if($(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=0]').attr(':checked'))
					day+='0';
				var heure=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Minute]').val();
				var minute=$(this).closest('.ProgramationGroup').find('.expressionAttr[data-l1key=Heure]').val();
				sendProgramation(prog,day,heure,minute);	
			});	
		}
	</script>
</div>
